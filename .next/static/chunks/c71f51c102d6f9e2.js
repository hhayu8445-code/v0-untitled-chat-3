(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,72724,(e,t,r)=>{"use strict";var s=e.r(84025),a="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},n=s.useState,i=s.useEffect,l=s.useLayoutEffect,o=s.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!a(e,r)}catch(e){return!0}}var u="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),s=n({inst:{value:r,getSnapshot:t}}),a=s[0].inst,u=s[1];return l(function(){a.value=r,a.getSnapshot=t,c(a)&&u({inst:a})},[e,r,t]),i(function(){return c(a)&&u({inst:a}),e(function(){c(a)&&u({inst:a})})},[e]),o(r),r};r.useSyncExternalStore=void 0!==s.useSyncExternalStore?s.useSyncExternalStore:u},307,(e,t,r)=>{"use strict";t.exports=e.r(72724)},29448,e=>{"use strict";let t;var r=e.i(34355),s=e.i(84025),a=e.i(13993),n=e.i(3339),i=e.i(53746),l=e.i(38589),o=e.i(61833),c=e.i(48066),u=e.i(94938),d=e.i(60821),f=e.i(9481),m=e.i(22687),h=e.i(99783),g=e.i(42242),x=e.i(8591),p=e.i(14156),v=e.i(46600),y=e.i(52368),b=e.i(11317);let j=(0,b.default)("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);var w=e.i(81987);let N=(0,b.default)("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),S=(0,b.default)("ImagePlus",[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]);var E=e.i(88924),k=e.i(43578),O=e.i(307);e.s(["ERROR_REVALIDATE_EVENT",()=>3,"FOCUS_EVENT",()=>0,"MUTATE_EVENT",()=>2,"RECONNECT_EVENT",()=>1],66987);var T=Object.prototype.hasOwnProperty;let R=new WeakMap,C=()=>{},_=C(),L=Object,I=e=>e===_,M=(e,t)=>({...e,...t}),V={},D={},A="undefined",P=typeof window!=A,F=typeof document!=A,$=P&&"Deno"in window,q=(e,t)=>{let r=R.get(e);return[()=>!I(t)&&e.get(t)||V,s=>{if(!I(t)){let a=e.get(t);t in D||(D[t]=a),r[5](t,M(a,s),a||V)}},r[6],()=>!I(t)&&t in D?D[t]:!I(t)&&e.get(t)||V]},U=!0,[B,W]=P&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[C,C],z={initFocus:e=>(F&&document.addEventListener("visibilitychange",e),B("focus",e),()=>{F&&document.removeEventListener("visibilitychange",e),W("focus",e)}),initReconnect:e=>{let t=()=>{U=!0,e()},r=()=>{U=!1};return B("online",t),B("offline",r),()=>{W("online",t),W("offline",r)}}},J=!s.default.useId,K=!P||$,H=K?s.useEffect:s.useLayoutEffect,Y="undefined"!=typeof navigator&&navigator.connection,X=!K&&Y&&(["slow-2g","2g"].includes(Y.effectiveType)||Y.saveData),G=new WeakMap,Q=(e,t)=>e===`[object ${t}]`,Z=0,ee=e=>{let t,r,s=typeof e,a=L.prototype.toString.call(e),n=Q(a,"Date"),i=Q(a,"RegExp"),l=Q(a,"Object");if(L(e)!==e||n||i)t=n?e.toJSON():"symbol"==s?e.toString():"string"==s?JSON.stringify(e):""+e;else{if(t=G.get(e))return t;if(t=++Z+"~",G.set(e,t),Array.isArray(e)){for(r=0,t="@";r<e.length;r++)t+=ee(e[r])+",";G.set(e,t)}if(l){t="#";let s=L.keys(e).sort();for(;!I(r=s.pop());)I(e[r])||(t+=r+":"+ee(e[r])+",");G.set(e,t)}}return t},et=e=>{if("function"==typeof e)try{e=e()}catch(t){e=""}let t=e;return[e="string"==typeof e?e:(Array.isArray(e)?e.length:e)?ee(e):"",t]},er=0,es=()=>++er;async function ea(...e){let[t,r,s,a]=e,n=M({populateCache:!0,throwOnError:!0},"boolean"==typeof a?{revalidate:a}:a||{}),i=n.populateCache,l=n.rollbackOnError,o=n.optimisticData,c=n.throwOnError;if("function"==typeof r){let e=[];for(let s of t.keys())!/^\$(inf|sub)\$/.test(s)&&r(t.get(s)._k)&&e.push(s);return Promise.all(e.map(u))}return u(r);async function u(r){let a,[u]=et(r);if(!u)return;let[d,f]=q(t,u),[m,h,g,x]=R.get(t),p=()=>{let e=m[u];return("function"==typeof n.revalidate?n.revalidate(d().data,r):!1!==n.revalidate)&&(delete g[u],delete x[u],e&&e[0])?e[0](2).then(()=>d().data):d().data};if(e.length<3)return p();let v=s,y=!1,b=es();h[u]=[b,0];let j=!I(o),w=d(),N=w.data,S=w._c,E=I(S)?N:S;if(j&&f({data:o="function"==typeof o?o(E,N):o,_c:E}),"function"==typeof v)try{v=v(E)}catch(e){a=e,y=!0}if(v&&"function"==typeof v.then){let e;if(v=await v.catch(e=>{a=e,y=!0}),b!==h[u][0]){if(y)throw a;return v}y&&j&&(e=a,"function"==typeof l?l(e):!1!==l)&&(i=!0,f({data:E,_c:_}))}if(i&&!y&&("function"==typeof i?f({data:i(v,E),error:_,_c:_}):f({data:v,error:_,_c:_})),h[u][1]=es(),Promise.resolve(p()).then(()=>{f({_c:_})}),y){if(c)throw a;return}return v}}let en=(e,t)=>{for(let r in e)e[r][0]&&e[r][0](t)},ei=(e,t)=>{if(!R.has(e)){let r=M(z,t),s=Object.create(null),a=ea.bind(_,e),n=C,i=Object.create(null),l=(e,t)=>{let r=i[e]||[];return i[e]=r,r.push(t),()=>r.splice(r.indexOf(t),1)},o=(t,r,s)=>{e.set(t,r);let a=i[t];if(a)for(let e of a)e(r,s)},c=()=>{if(!R.has(e)&&(R.set(e,[s,Object.create(null),Object.create(null),Object.create(null),a,o,l]),!K)){let t=r.initFocus(setTimeout.bind(_,en.bind(_,s,0))),a=r.initReconnect(setTimeout.bind(_,en.bind(_,s,1)));n=()=>{t&&t(),a&&a(),R.delete(e)}}};return c(),[e,a,c,n]}return[e,R.get(e)[4]]},[el,eo]=ei(new Map),ec=M({onLoadingSlow:C,onSuccess:C,onError:C,onErrorRetry:(e,t,r,s,a)=>{let n=r.errorRetryCount,i=a.retryCount,l=~~((Math.random()+.5)*(1<<(i<8?i:8)))*r.errorRetryInterval;(I(n)||!(i>n))&&setTimeout(s,l,a)},onDiscarded:C,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:X?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:X?5e3:3e3,compare:function e(t,r){var s,a;if(t===r)return!0;if(t&&r&&(s=t.constructor)===r.constructor){if(s===Date)return t.getTime()===r.getTime();if(s===RegExp)return t.toString()===r.toString();if(s===Array){if((a=t.length)===r.length)for(;a--&&e(t[a],r[a]););return -1===a}if(!s||"object"==typeof t){for(s in a=0,t)if(T.call(t,s)&&++a&&!T.call(r,s)||!(s in r)||!e(t[s],r[s]))return!1;return Object.keys(r).length===a}}return t!=t&&r!=r},isPaused:()=>!1,cache:el,mutate:eo,fallback:{}},{isOnline:()=>U,isVisible:()=>{let e=F&&document.visibilityState;return I(e)||"hidden"!==e}}),eu=(e,t)=>{let r=M(e,t);if(t){let{use:s,fallback:a}=e,{use:n,fallback:i}=t;s&&n&&(r.use=s.concat(n)),a&&i&&(r.fallback=M(a,i))}return r},ed=(0,s.createContext)({});var ef=e.i(66987);let em=P&&window.__SWR_DEVTOOLS_USE__,eh=(em?window.__SWR_DEVTOOLS_USE__:[]).concat(e=>(t,r,s)=>{let a=r&&((...e)=>{let[s]=et(t),[,,,a]=R.get(el);if(s.startsWith("$inf$"))return r(...e);let n=a[s];return I(n)?r(...e):(delete a[s],n)});return e(t,a,s)});em&&(window.__SWR_DEVTOOLS_REACT__=s.default);let eg=()=>{},ex=eg(),ep=(new WeakMap,s.default.use||(e=>{switch(e.status){case"pending":throw e;case"fulfilled":return e.value;case"rejected":throw e.reason;default:throw e.status="pending",e.then(t=>{e.status="fulfilled",e.value=t},t=>{e.status="rejected",e.reason=t}),e}})),ev={dedupe:!0},ey=Promise.resolve(_);L.defineProperty(e=>{let{value:t}=e,r=(0,s.useContext)(ed),a="function"==typeof t,n=(0,s.useMemo)(()=>a?t(r):t,[a,r,t]),i=(0,s.useMemo)(()=>a?n:eu(r,n),[a,r,n]),l=n&&n.provider,o=(0,s.useRef)(_);l&&!o.current&&(o.current=ei(l(i.cache||el),n));let c=o.current;return c&&(i.cache=c[0],i.mutate=c[1]),H(()=>{if(c)return c[2]&&c[2](),c[3]},[]),(0,s.createElement)(ed.Provider,M(e,{value:i}))},"defaultValue",{value:ec});let eb=(t=(e,t,r)=>{let{cache:a,compare:n,suspense:i,fallbackData:l,revalidateOnMount:o,revalidateIfStale:c,refreshInterval:u,refreshWhenHidden:d,refreshWhenOffline:f,keepPreviousData:m,strictServerPrefetchWarning:h}=r,[g,x,p,v]=R.get(a),[y,b]=et(e),j=(0,s.useRef)(!1),w=(0,s.useRef)(!1),N=(0,s.useRef)(y),S=(0,s.useRef)(t),E=(0,s.useRef)(r),k=()=>E.current.isVisible()&&E.current.isOnline(),[T,L,V,D]=q(a,y),F=(0,s.useRef)({}).current,$=I(l)?I(r.fallback)?_:r.fallback[y]:l,U=(e,t)=>{for(let r in F)if("data"===r){if(!n(e[r],t[r])&&(!I(e[r])||!n(ee,t[r])))return!1}else if(t[r]!==e[r])return!1;return!0},B=(0,s.useMemo)(()=>{let e=!!y&&!!t&&(I(o)?!E.current.isPaused()&&!i&&!1!==c:o),r=t=>{let r=M(t);return(delete r._k,e)?{isValidating:!0,isLoading:!0,...r}:r},s=T(),a=D(),n=r(s),l=s===a?n:r(a),u=n;return[()=>{let e=r(T());return U(e,u)?(u.data=e.data,u.isLoading=e.isLoading,u.isValidating=e.isValidating,u.error=e.error,u):(u=e,e)},()=>l]},[a,y]),W=(0,O.useSyncExternalStore)((0,s.useCallback)(e=>V(y,(t,r)=>{U(r,t)||e()}),[a,y]),B[0],B[1]),z=!j.current,Y=g[y]&&g[y].length>0,X=W.data,G=I(X)?$&&"function"==typeof $.then?ep($):$:X,Q=W.error,Z=(0,s.useRef)(G),ee=m?I(X)?I(Z.current)?G:Z.current:X:G,er=y&&I(G),en=!K&&(0,O.useSyncExternalStore)(()=>C,()=>!1,()=>!0);h&&en&&!i&&er&&console.warn(`Missing pre-initiated data for serialized key "${y}" during server-side rendering. Data fethcing should be initiated on the server and provided to SWR via fallback data. You can set "strictServerPrefetchWarning: false" to disable this warning.`);let ei=(!Y||!!I(Q))&&(z&&!I(o)?o:!E.current.isPaused()&&(i?!I(G)&&c:I(G)||c)),el=!!(y&&t&&z&&ei),eo=I(W.isValidating)?el:W.isValidating,ec=I(W.isLoading)?el:W.isLoading,eu=(0,s.useCallback)(async e=>{let t,s,a=S.current;if(!y||!a||w.current||E.current.isPaused())return!1;let i=!0,l=e||{},o=!p[y]||!l.dedupe,c=()=>J?!w.current&&y===N.current&&j.current:y===N.current,u={isValidating:!1,isLoading:!1},d=()=>{L(u)},f=()=>{let e=p[y];e&&e[1]===s&&delete p[y]},m={isValidating:!0};I(T().data)&&(m.isLoading=!0);try{if(o&&(L(m),r.loadingTimeout&&I(T().data)&&setTimeout(()=>{i&&c()&&E.current.onLoadingSlow(y,r)},r.loadingTimeout),p[y]=[a(b),es()]),[t,s]=p[y],t=await t,o&&setTimeout(f,r.dedupingInterval),!p[y]||p[y][1]!==s)return o&&c()&&E.current.onDiscarded(y),!1;u.error=_;let e=x[y];if(!I(e)&&(s<=e[0]||s<=e[1]||0===e[1]))return d(),o&&c()&&E.current.onDiscarded(y),!1;let l=T().data;u.data=n(l,t)?l:t,o&&c()&&E.current.onSuccess(t,y,r)}catch(r){f();let e=E.current,{shouldRetryOnError:t}=e;!e.isPaused()&&(u.error=r,o&&c())&&(e.onError(r,y,e),(!0===t||"function"==typeof t&&t(r))&&(!E.current.revalidateOnFocus||!E.current.revalidateOnReconnect||k())&&e.onErrorRetry(r,y,e,e=>{let t=g[y];t&&t[0]&&t[0](ef.ERROR_REVALIDATE_EVENT,e)},{retryCount:(l.retryCount||0)+1,dedupe:!0}))}return i=!1,d(),!0},[y,a]),ed=(0,s.useCallback)((...e)=>ea(a,N.current,...e),[]);if(H(()=>{S.current=t,E.current=r,I(X)||(Z.current=X)}),H(()=>{var e;let t;if(!y)return;let r=eu.bind(_,ev),s=0;E.current.revalidateOnFocus&&(s=Date.now()+E.current.focusThrottleInterval);let a=(e=(e,t={})=>{if(e==ef.FOCUS_EVENT){let e=Date.now();E.current.revalidateOnFocus&&e>s&&k()&&(s=e+E.current.focusThrottleInterval,r())}else if(e==ef.RECONNECT_EVENT)E.current.revalidateOnReconnect&&k()&&r();else if(e==ef.MUTATE_EVENT)return eu();else if(e==ef.ERROR_REVALIDATE_EVENT)return eu(t)},(t=g[y]||(g[y]=[])).push(e),()=>{let r=t.indexOf(e);r>=0&&(t[r]=t[t.length-1],t.pop())});if(w.current=!1,N.current=y,j.current=!0,L({_k:b}),ei&&!p[y])if(I(G)||K)r();else P&&typeof window.requestAnimationFrame!=A?window.requestAnimationFrame(r):setTimeout(r,1);return()=>{w.current=!0,a()}},[y]),H(()=>{let e;function t(){let t="function"==typeof u?u(T().data):u;t&&-1!==e&&(e=setTimeout(r,t))}function r(){!T().error&&(d||E.current.isVisible())&&(f||E.current.isOnline())?eu(ev).then(t):t()}return t(),()=>{e&&(clearTimeout(e),e=-1)}},[u,d,f,y]),(0,s.useDebugValue)(ee),i){if(!J&&K&&er)throw Error("Fallback data is required when using Suspense in SSR.");er&&(S.current=t,E.current=r,w.current=!1);let e=v[y];if(ep(!I(e)&&er?ed(e):ey),!I(Q)&&er)throw Q;let s=er?eu(ev):ey;!I(ee)&&er&&(s.status="fulfilled",s.value=!0),ep(s)}return{mutate:ed,get data(){return F.data=!0,ee},get error(){return F.error=!0,Q},get isValidating(){return F.isValidating=!0,eo},get isLoading(){return F.isLoading=!0,ec}}},function(...e){let r,a=(r=(0,s.useContext)(ed),(0,s.useMemo)(()=>M(ec,r),[r])),[n,i,l]="function"==typeof e[1]?[e[0],e[1],e[2]||{}]:[e[0],null,(null===e[1]?e[2]:e[1])||{}],o=eu(a,l),c=t,{use:u}=o,d=(u||[]).concat(eh);for(let e=d.length;e--;)c=d[e](c);return c(n,i||o.fetcher||null,o)}),ej=e=>fetch(e).then(e=>e.json());function ew(){let{user:e,isLoading:t}=(0,c.useAuth)(),b=(0,a.useRouter)(),O=(0,a.useSearchParams)().get("to"),[T,R]=(0,s.useState)(null),[C,_]=(0,s.useState)(""),[L,I]=(0,s.useState)(!1),[M,V]=(0,s.useState)(""),[D,A]=(0,s.useState)(!0),[P,F]=(0,s.useState)(!1),[$,q]=(0,s.useState)(null),[U,B]=(0,s.useState)(null),W=(0,s.useRef)(null),z=(0,s.useRef)(null),J=(0,s.useRef)(0),{data:K,mutate:H}=eb(e?"/api/messages/conversations":null,ej,{refreshInterval:5e3}),Y=K?.conversations||[],{data:X,mutate:G}=eb(T?`/api/messages?userId=${T.user.discordId}`:null,ej,{refreshInterval:2e3}),Q=X?.messages||[];(0,s.useEffect)(()=>{t||e||b.push("/")},[e,t,b]),(0,s.useEffect)(()=>{W.current?.scrollIntoView({behavior:"smooth"})},[Q]),(0,s.useEffect)(()=>{if(Q.length>J.current&&J.current>0){let t=Q[Q.length-1];if(t.senderId!==e?.id&&D){let e=new Audio("/notification.mp3");e.volume=.3,e.play().catch(()=>{}),"granted"===Notification.permission&&new Notification("New Message",{body:t.content.substring(0,50),icon:T?.user.avatar||"/placeholder.svg"})}}J.current=Q.length},[Q,e?.id,D,T]),(0,s.useEffect)(()=>{O&&e&&Z(O)},[O,e]),(0,s.useEffect)(()=>{"default"===Notification.permission&&Notification.requestPermission()},[]);let Z=async e=>{try{let t=await fetch(`/api/profile/${e}`);if(t.ok){let r=await t.json(),s={id:r.user.id,discordId:r.user.discordId||e,username:r.user.username,avatar:r.user.avatar,membership:r.user.membership};R({id:e,user:s,lastMessage:"",lastMessageAt:new Date().toISOString(),unreadCount:0})}}catch(e){console.error("Failed to start conversation:",e)}},ee=async e=>{let t=e.target.files?.[0];if(t){if(!t.type.startsWith("image/"))return void k.toast.error("Please select an image file");if(t.size>5242880)return void k.toast.error("Image must be less than 5MB");F(!0),q(URL.createObjectURL(t));try{let e=new FormData;e.append("file",t),e.append("folder","messages");let r=await fetch("/api/upload/blob",{method:"POST",body:e});if(!r.ok)throw Error("Upload failed");let s=await r.json();B(s.url),k.toast.success("Image ready to send!")}catch(e){k.toast.error("Failed to upload image"),q(null)}finally{F(!1)}}},et=()=>{q(null),B(null),z.current&&(z.current.value="")},er=async()=>{if((C.trim()||U)&&T&&!L){I(!0);try{let e=U?`${C.trim()}
[Image: ${U}]`:C.trim(),t=await fetch("/api/messages",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({receiverId:T.user.discordId,content:e})});if(t.ok)_(""),et(),G(),H();else{let e=await t.json();k.toast.error(e.error||"Failed to send message")}}catch(e){k.toast.error("Failed to send message")}finally{I(!1)}}},es=e=>{let t=new Date(e),r=new Date().getTime()-t.getTime();return r<6e4?"Just now":r<36e5?`${Math.floor(r/6e4)}m ago`:r<864e5?t.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}):t.toLocaleDateString()},ea=Y.filter(e=>e.user.username.toLowerCase().includes(M.toLowerCase())),en=Y.reduce((e,t)=>e+t.unreadCount,0);return t?(0,r.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center",children:(0,r.jsx)(g.Loader2,{className:"h-8 w-8 animate-spin text-primary"})}):e?(0,r.jsxs)("div",{className:"min-h-screen bg-background",children:[(0,r.jsx)(n.Sidebar,{}),(0,r.jsxs)("main",{className:"md:ml-72 transition-all duration-300",children:[(0,r.jsx)(i.Header,{}),(0,r.jsxs)("div",{className:"flex h-[calc(100vh-4rem)]",children:[(0,r.jsxs)("div",{className:"w-80 border-r border-border glass flex flex-col",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-border/50",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-foreground",children:"Messages"}),en>0&&(0,r.jsx)("span",{className:"flex h-5 min-w-5 px-1 items-center justify-center rounded-full bg-primary text-[10px] font-bold text-primary-foreground",children:en})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(l.Button,{size:"icon",variant:"ghost",className:"h-9 w-9 rounded-xl hover:bg-secondary",onClick:()=>A(!D),title:D?"Mute notifications":"Enable notifications",children:D?(0,r.jsx)(w.Bell,{className:"h-4 w-4 text-primary"}):(0,r.jsx)(N,{className:"h-4 w-4 text-muted-foreground"})}),(0,r.jsx)(l.Button,{size:"icon",variant:"ghost",className:"h-9 w-9 rounded-xl hover:bg-secondary",children:(0,r.jsx)(u.Plus,{className:"h-5 w-5"})})]})]}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(d.Search,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,r.jsx)(o.Input,{placeholder:"Search conversations...",value:M,onChange:e=>V(e.target.value),className:"pl-10 h-10 bg-secondary/50 border-border/50 rounded-xl"})]})]}),(0,r.jsx)("div",{className:"flex-1 overflow-y-auto scrollbar-thin",children:K?0===ea.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-64 px-4",children:[(0,r.jsx)(x.MessageSquare,{className:"h-12 w-12 text-muted-foreground/50 mb-3"}),(0,r.jsx)("p",{className:"text-muted-foreground text-center",children:"No conversations yet"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground text-center mt-1",children:"Start a conversation from a user profile"})]}):ea.map(e=>(0,r.jsxs)("button",{onClick:()=>{R(e),J.current=0,fetch("/api/messages/read",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({otherUserId:e.user.discordId})}).then(()=>H())},className:`w-full flex items-center gap-3 p-4 transition-colors border-l-2 ${T?.id===e.id?"bg-primary/10 border-l-primary":"border-l-transparent hover:bg-secondary/30"}`,children:[(0,r.jsxs)("div",{className:"relative shrink-0",children:[(0,r.jsx)("img",{src:e.user.avatar||"/placeholder.svg?height=48&width=48&query=user",alt:e.user.username,className:"h-12 w-12 rounded-xl object-cover"}),"vip"===e.user.membership&&(0,r.jsx)(p.Crown,{className:"absolute -bottom-1 -right-1 h-4 w-4 text-primary bg-background rounded-full p-0.5"}),"admin"===e.user.membership&&(0,r.jsx)(v.Shield,{className:"absolute -bottom-1 -right-1 h-4 w-4 text-destructive bg-background rounded-full p-0.5"})]}),(0,r.jsxs)("div",{className:"flex-1 min-w-0 text-left",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("span",{className:"font-medium text-foreground",children:e.user.username}),(0,r.jsx)("span",{className:"text-[10px] text-muted-foreground",children:es(e.lastMessageAt)})]}),(0,r.jsx)("p",{className:"text-sm text-muted-foreground truncate",children:e.lastMessage.includes("[Image:")?"Sent an image":e.lastMessage})]}),e.unreadCount>0&&(0,r.jsx)("span",{className:"flex h-5 w-5 items-center justify-center rounded-full bg-primary text-[10px] font-bold text-primary-foreground shrink-0 animate-pulse",children:e.unreadCount})]},e.id)):(0,r.jsx)("div",{className:"flex items-center justify-center h-32",children:(0,r.jsx)(g.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"})})})]}),(0,r.jsx)("div",{className:"flex-1 flex flex-col",children:T?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-4 border-b border-border/50 glass",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)("img",{src:T.user.avatar||"/placeholder.svg?height=44&width=44&query=user",alt:T.user.username,className:"h-11 w-11 rounded-xl object-cover"})}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h3",{className:"font-semibold text-foreground flex items-center gap-2",children:[T.user.username,"vip"===T.user.membership&&(0,r.jsx)(p.Crown,{className:"h-4 w-4 text-primary"}),"admin"===T.user.membership&&(0,r.jsx)(v.Shield,{className:"h-4 w-4 text-destructive"})]}),(0,r.jsxs)("p",{className:"text-xs text-muted-foreground capitalize",children:[T.user.membership," Member"]})]})]}),(0,r.jsx)(l.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-xl text-muted-foreground hover:text-foreground",children:(0,r.jsx)(m.MoreVertical,{className:"h-5 w-5"})})]}),(0,r.jsxs)("div",{className:"flex-1 overflow-y-auto p-6 space-y-4 scrollbar-thin",children:[0===Q.length?(0,r.jsxs)("div",{className:"flex flex-col items-center justify-center h-full",children:[(0,r.jsx)(x.MessageSquare,{className:"h-12 w-12 text-muted-foreground/50 mb-3"}),(0,r.jsx)("p",{className:"text-muted-foreground",children:"No messages yet"}),(0,r.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"Send a message to start the conversation"})]}):Q.map(t=>{let s=t.senderId===e.id;return(0,r.jsxs)("div",{className:`flex gap-3 ${s?"justify-end":""}`,children:[!s&&(0,r.jsx)("img",{src:T.user.avatar||"/placeholder.svg?height=32&width=32&query=user",alt:"",className:"h-8 w-8 rounded-lg shrink-0 mt-1"}),(0,r.jsxs)("div",{className:`max-w-md ${s?"order-1":""}`,children:[(0,r.jsx)("div",{className:`rounded-2xl px-4 py-3 ${s?"bg-primary text-primary-foreground rounded-br-md":"glass rounded-bl-md"}`,children:(0,r.jsx)("div",{className:s?"text-primary-foreground":"text-foreground",children:(e=>{let t=e.match(/\[Image: (https?:\/\/[^\]]+)\]/);if(t){let s=e.replace(/\[Image: https?:\/\/[^\]]+\]/,"").trim();return(0,r.jsxs)(r.Fragment,{children:[s&&(0,r.jsx)("p",{className:"mb-2",children:s}),(0,r.jsx)("img",{src:t[1]||"/placeholder.svg",alt:"Shared image",className:"max-w-xs rounded-lg cursor-pointer hover:opacity-90 transition-opacity",onClick:()=>window.open(t[1],"_blank")})]})}return(0,r.jsx)("p",{children:e})})(t.content)})}),(0,r.jsxs)("div",{className:`flex items-center gap-1 mt-1 ${s?"justify-end":""}`,children:[(0,r.jsx)("span",{className:"text-[10px] text-muted-foreground",children:es(t.createdAt)}),s&&(t.read?(0,r.jsx)(j,{className:"h-3 w-3 text-primary"}):(0,r.jsx)(y.Check,{className:"h-3 w-3 text-muted-foreground"}))]})]})]},t.id)}),(0,r.jsx)("div",{ref:W})]}),$&&(0,r.jsx)("div",{className:"px-4 py-2 border-t border-border/50",children:(0,r.jsxs)("div",{className:"relative inline-block",children:[(0,r.jsx)("img",{src:$||"/placeholder.svg",alt:"Preview",className:"h-20 w-20 object-cover rounded-lg"}),P&&(0,r.jsx)("div",{className:"absolute inset-0 bg-background/80 rounded-lg flex items-center justify-center",children:(0,r.jsx)(g.Loader2,{className:"h-5 w-5 animate-spin text-primary"})}),(0,r.jsx)("button",{onClick:et,className:"absolute -top-2 -right-2 p-1 bg-destructive rounded-full",children:(0,r.jsx)(E.X,{className:"h-3 w-3 text-white"})})]})}),(0,r.jsx)("div",{className:"p-4 border-t border-border/50 glass",children:(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[(0,r.jsx)("input",{ref:z,type:"file",accept:"image/*",onChange:ee,className:"hidden"}),(0,r.jsx)(l.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-xl text-muted-foreground hover:text-foreground shrink-0",onClick:()=>z.current?.click(),disabled:P,children:(0,r.jsx)(S,{className:"h-5 w-5"})}),(0,r.jsx)(o.Input,{placeholder:"Type a message...",value:C,onChange:e=>_(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),er())},className:"flex-1 h-11 bg-secondary/50 border-border/50 rounded-xl"}),(0,r.jsx)(l.Button,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-xl text-muted-foreground hover:text-foreground shrink-0",children:(0,r.jsx)(h.Smile,{className:"h-5 w-5"})}),(0,r.jsx)(l.Button,{size:"icon",className:"h-10 w-10 rounded-xl bg-primary hover:bg-primary/90 glow-sm shrink-0",onClick:er,disabled:!C.trim()&&!U||L||P,children:L?(0,r.jsx)(g.Loader2,{className:"h-5 w-5 animate-spin"}):(0,r.jsx)(f.Send,{className:"h-5 w-5"})})]})})]}):(0,r.jsxs)("div",{className:"flex-1 flex flex-col items-center justify-center",children:[(0,r.jsx)(x.MessageSquare,{className:"h-16 w-16 text-muted-foreground/50 mb-4"}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-foreground mb-2",children:"Your Messages"}),(0,r.jsx)("p",{className:"text-muted-foreground text-center max-w-sm",children:"Select a conversation to view messages or start a new chat from a user profile"})]})})]})]})]}):null}e.s(["default",()=>ew],29448)}]);