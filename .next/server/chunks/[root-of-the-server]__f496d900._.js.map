{"version":3,"sources":["../../../../../../Pictures/APPLICATION%20DECRYPT%20FULL%20NO%20FXAP/TOOLS%20WEBSITE/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\nimport { cookies } from \"next/headers\"\n\nfunction getSupabaseUrl(): string {\n  const url = process.env.NEXT_PUBLIC_SUPABASE_URL\n  if (!url && process.env.NODE_ENV !== 'production') {\n    console.warn(\"Missing NEXT_PUBLIC_SUPABASE_URL\")\n    return ''\n  }\n  return url || ''\n}\n\nfunction getSupabaseAnonKey(): string {\n  const key = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY\n  if (!key && process.env.NODE_ENV !== 'production') {\n    console.warn(\"Missing NEXT_PUBLIC_SUPABASE_ANON_KEY\")\n    return ''\n  }\n  return key || ''\n}\n\nfunction getSupabaseServiceRoleKey(): string {\n  const key = process.env.SUPABASE_SERVICE_ROLE_KEY\n  if (!key && process.env.NODE_ENV !== 'production') {\n    console.warn(\"Missing SUPABASE_SERVICE_ROLE_KEY\")\n    return ''\n  }\n  return key || ''\n}\n\n/**\n * Creates a Supabase client for server-side operations\n * Always create a new client within each function\n */\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient(getSupabaseUrl(), getSupabaseAnonKey(), {\n    cookies: {\n      getAll() {\n        return cookieStore.getAll()\n      },\n      setAll(cookiesToSet) {\n        try {\n          cookiesToSet.forEach(({ name, value, options }) => cookieStore.set(name, value, options))\n        } catch {\n          // Server Component - ignore\n        }\n      },\n    },\n  })\n}\n\n/**\n * Creates an admin Supabase client that bypasses RLS\n * Removed cookies dependency - admin client doesn't need cookies\n * This fixes the \"cookies() was called outside of request\" error in NextAuth callbacks\n */\nexport async function createAdminClient() {\n  const { createClient } = await import(\"@supabase/supabase-js\")\n\n  return createClient(getSupabaseUrl(), getSupabaseServiceRoleKey(), {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  })\n}\n\n// Aliases for backward compatibility\nexport const getSupabaseServerClient = createClient\nexport const getSupabaseAdminClient = createAdminClient\n"],"names":[],"mappings":"8LAAA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAEA,SAAS,IAMP,OALY,AAKL,QALa,GAAG,CAAC,wBAAwB,EAKlC,EAChB,CAwBO,eAAe,IACpB,IAAM,EAAc,MAAM,CAAA,EAAA,EAAA,OAAA,AAAO,IAEjC,MAAO,CAAA,EAAA,EAAA,kBAAA,AAAkB,EAAC,IAxBd,QAAQ,GAAG,CAAC,EAwBoB,2BAxBS,EAKvC,GAmBoD,CAChE,QAAS,QACP,IACS,EAAY,MAAM,GAE3B,OAAO,CAAY,EACjB,GAAI,CACF,EAAa,OAAO,CAAC,CAAC,MAAE,CAAI,OAAE,CAAK,SAAE,CAAO,CAAE,GAAK,EAAY,GAAG,CAAC,EAAM,EAAO,GAClF,CAAE,KAAM,CAER,CACF,CACF,CACF,EACF,CAOO,eAAe,IACpB,GAAM,cAAE,CAAY,CAAE,CAAG,MAAA,EAAA,CAAA,CAAA,OAEzB,OAAO,EAAa,IAvCR,QAAQ,GAAG,CAAC,EAuCc,uBAvCW,EAKnC,GAkCqD,CACjE,KAAM,CACJ,kBAAkB,EAClB,gBAAgB,CAClB,CACF,EACF,gFAIsC"}