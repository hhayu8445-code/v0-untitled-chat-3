{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 88, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/MUDDING%20UNDERGROUND/Pictures/APPLICATION%20DECRYPT%20FULL%20NO%20FXAP/TOOLS%20WEBSITE/lib/security-edge.ts"],"sourcesContent":["// Edge Runtime compatible security utilities\nconst rateLimitStore = new Map<string, { count: number; resetAt: number; blocked: boolean }>()\n\nexport const security = {\n  checkRateLimit(identifier: string, maxRequests = 100, windowMs = 60000): boolean {\n    const now = Date.now()\n    const record = rateLimitStore.get(identifier)\n\n    // Cleanup old entries periodically\n    if (rateLimitStore.size > 10000) {\n      for (const [key, value] of rateLimitStore.entries()) {\n        if (now > value.resetAt) rateLimitStore.delete(key)\n      }\n    }\n\n    // If no record or window expired, create new record\n    if (!record || now > record.resetAt) {\n      rateLimitStore.set(identifier, { count: 1, resetAt: now + windowMs, blocked: false })\n      return true\n    }\n\n    // If already blocked in current window, deny\n    if (record.blocked) {\n      return false\n    }\n\n    // If limit reached, block and deny\n    if (record.count >= maxRequests) {\n      record.blocked = true\n      return false\n    }\n\n    // Increment count and allow\n    record.count++\n    return true\n  },\n\n  generateCSRFToken(sessionId: string): string {\n    const timestamp = Date.now().toString()\n    return btoa(`${sessionId}:${timestamp}:csrf`)\n  },\n\n  verifyCSRFToken(token: string, sessionId: string): boolean {\n    if (!token || !sessionId) return false\n    try {\n      const decoded = atob(token)\n      const [id, timestamp] = decoded.split(\":\")\n      const tokenAge = Date.now() - Number.parseInt(timestamp)\n      return id === sessionId && tokenAge < 3600000\n    } catch {\n      return false\n    }\n  },\n\n  logSecurityEvent(event: string, details: any, severity: \"low\" | \"medium\" | \"high\" | \"critical\" = \"medium\"): void {\n    console.log(`[SECURITY-${severity.toUpperCase()}] ${new Date().toISOString()}: ${event}`, details)\n  },\n}\n"],"names":[],"mappings":"AAAA,6CAA6C;;;;;AAC7C,MAAM,iBAAiB,IAAI;AAEpB,MAAM,WAAW;IACtB,gBAAe,UAAkB,EAAE,cAAc,GAAG,EAAE,WAAW,KAAK;QACpE,MAAM,MAAM,KAAK,GAAG;QACpB,MAAM,SAAS,eAAe,GAAG,CAAC;QAElC,mCAAmC;QACnC,IAAI,eAAe,IAAI,GAAG,OAAO;YAC/B,KAAK,MAAM,CAAC,KAAK,MAAM,IAAI,eAAe,OAAO,GAAI;gBACnD,IAAI,MAAM,MAAM,OAAO,EAAE,eAAe,MAAM,CAAC;YACjD;QACF;QAEA,oDAAoD;QACpD,IAAI,CAAC,UAAU,MAAM,OAAO,OAAO,EAAE;YACnC,eAAe,GAAG,CAAC,YAAY;gBAAE,OAAO;gBAAG,SAAS,MAAM;gBAAU,SAAS;YAAM;YACnF,OAAO;QACT;QAEA,6CAA6C;QAC7C,IAAI,OAAO,OAAO,EAAE;YAClB,OAAO;QACT;QAEA,mCAAmC;QACnC,IAAI,OAAO,KAAK,IAAI,aAAa;YAC/B,OAAO,OAAO,GAAG;YACjB,OAAO;QACT;QAEA,4BAA4B;QAC5B,OAAO,KAAK;QACZ,OAAO;IACT;IAEA,mBAAkB,SAAiB;QACjC,MAAM,YAAY,KAAK,GAAG,GAAG,QAAQ;QACrC,OAAO,KAAK,GAAG,UAAU,CAAC,EAAE,UAAU,KAAK,CAAC;IAC9C;IAEA,iBAAgB,KAAa,EAAE,SAAiB;QAC9C,IAAI,CAAC,SAAS,CAAC,WAAW,OAAO;QACjC,IAAI;YACF,MAAM,UAAU,KAAK;YACrB,MAAM,CAAC,IAAI,UAAU,GAAG,QAAQ,KAAK,CAAC;YACtC,MAAM,WAAW,KAAK,GAAG,KAAK,OAAO,QAAQ,CAAC;YAC9C,OAAO,OAAO,aAAa,WAAW;QACxC,EAAE,OAAM;YACN,OAAO;QACT;IACF;IAEA,kBAAiB,KAAa,EAAE,OAAY,EAAE,WAAmD,QAAQ;QACvG,QAAQ,GAAG,CAAC,CAAC,UAAU,EAAE,SAAS,WAAW,GAAG,EAAE,EAAE,IAAI,OAAO,WAAW,GAAG,EAAE,EAAE,OAAO,EAAE;IAC5F;AACF"}},
    {"offset": {"line": 149, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/MUDDING%20UNDERGROUND/Pictures/APPLICATION%20DECRYPT%20FULL%20NO%20FXAP/TOOLS%20WEBSITE/lib/supabase/proxy.ts"],"sourcesContent":["import { createServerClient } from \"@supabase/ssr\"\nimport { NextResponse, type NextRequest } from \"next/server\"\n\nexport async function updateSession(request: NextRequest) {\n  let supabaseResponse = NextResponse.next({\n    request,\n  })\n\n  // Create Supabase client for middleware\n  const supabase = createServerClient(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return request.cookies.getAll()\n        },\n        setAll(cookiesToSet) {\n          cookiesToSet.forEach(({ name, value }) => request.cookies.set(name, value))\n          supabaseResponse = NextResponse.next({\n            request,\n          })\n          cookiesToSet.forEach(({ name, value, options }) => supabaseResponse.cookies.set(name, value, options))\n        },\n      },\n    },\n  )\n\n  // IMPORTANT: Do not run code between createServerClient and supabase.auth.getUser()\n  const {\n    data: { user },\n  } = await supabase.auth.getUser()\n\n  // Protected routes that require authentication\n  const protectedPaths = [\"/admin\", \"/dashboard\", \"/profile/edit\", \"/upload\"]\n  const isProtectedPath = protectedPaths.some((path) => request.nextUrl.pathname.startsWith(path))\n\n  // Redirect to login if accessing protected route without authentication\n  if (isProtectedPath && !user) {\n    const url = request.nextUrl.clone()\n    url.pathname = \"/auth/login\"\n    url.searchParams.set(\"redirect\", request.nextUrl.pathname)\n    return NextResponse.redirect(url)\n  }\n\n  // Admin routes require admin role\n  if (request.nextUrl.pathname.startsWith(\"/admin\") && user) {\n    const { data: userData } = await supabase.from(\"users\").select(\"role\").eq(\"discord_id\", user.id).single()\n\n    if (!userData || ![\"admin\", \"superadmin\"].includes(userData.role)) {\n      const url = request.nextUrl.clone()\n      url.pathname = \"/\"\n      return NextResponse.redirect(url)\n    }\n  }\n\n  return supabaseResponse\n}\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;;;AAEO,eAAe,cAAc,OAAoB;IACtD,IAAI,mBAAmB,oNAAY,CAAC,IAAI,CAAC;QACvC;IACF;IAEA,wCAAwC;IACxC,MAAM,WAAW,IAAA,qQAAkB,sUAGjC;QACE,SAAS;YACP;gBACE,OAAO,QAAQ,OAAO,CAAC,MAAM;YAC/B;YACA,QAAO,YAAY;gBACjB,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,GAAK,QAAQ,OAAO,CAAC,GAAG,CAAC,MAAM;gBACpE,mBAAmB,oNAAY,CAAC,IAAI,CAAC;oBACnC;gBACF;gBACA,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAAK,iBAAiB,OAAO,CAAC,GAAG,CAAC,MAAM,OAAO;YAC/F;QACF;IACF;IAGF,oFAAoF;IACpF,MAAM,EACJ,MAAM,EAAE,IAAI,EAAE,EACf,GAAG,MAAM,SAAS,IAAI,CAAC,OAAO;IAE/B,+CAA+C;IAC/C,MAAM,iBAAiB;QAAC;QAAU;QAAc;QAAiB;KAAU;IAC3E,MAAM,kBAAkB,eAAe,IAAI,CAAC,CAAC,OAAS,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC;IAE1F,wEAAwE;IACxE,IAAI,mBAAmB,CAAC,MAAM;QAC5B,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;QACjC,IAAI,QAAQ,GAAG;QACf,IAAI,YAAY,CAAC,GAAG,CAAC,YAAY,QAAQ,OAAO,CAAC,QAAQ;QACzD,OAAO,oNAAY,CAAC,QAAQ,CAAC;IAC/B;IAEA,kCAAkC;IAClC,IAAI,QAAQ,OAAO,CAAC,QAAQ,CAAC,UAAU,CAAC,aAAa,MAAM;QACzD,MAAM,EAAE,MAAM,QAAQ,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,SAAS,MAAM,CAAC,QAAQ,EAAE,CAAC,cAAc,KAAK,EAAE,EAAE,MAAM;QAEvG,IAAI,CAAC,YAAY,CAAC;YAAC;YAAS;SAAa,CAAC,QAAQ,CAAC,SAAS,IAAI,GAAG;YACjE,MAAM,MAAM,QAAQ,OAAO,CAAC,KAAK;YACjC,IAAI,QAAQ,GAAG;YACf,OAAO,oNAAY,CAAC,QAAQ,CAAC;QAC/B;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 212, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/MUDDING%20UNDERGROUND/Pictures/APPLICATION%20DECRYPT%20FULL%20NO%20FXAP/TOOLS%20WEBSITE/proxy.ts"],"sourcesContent":["import { NextResponse } from \"next/server\"\nimport type { NextRequest } from \"next/server\"\nimport { getToken } from \"next-auth/jwt\"\nimport { security } from \"./lib/security-edge\"\nimport { updateSession } from \"@/lib/supabase/proxy\"\n\nexport async function proxy(request: NextRequest) {\n  const { pathname } = request.nextUrl\n  const clientIP = request.headers.get(\"x-forwarded-for\") || request.headers.get(\"x-real-ip\") || \"unknown\"\n\n  const supabaseResponse = await updateSession(request)\n  if (supabaseResponse.status === 307 || supabaseResponse.status === 308) {\n    return supabaseResponse\n  }\n\n  // Rate limiting\n  if (!security.checkRateLimit(clientIP, 500, 60000)) {\n    return NextResponse.json({ error: \"Rate limit exceeded\" }, { status: 429 })\n  }\n\n  // Get NextAuth token\n  const token = await getToken({\n    req: request,\n    secret: process.env.NEXTAUTH_SECRET,\n  })\n\n  // Admin routes protection\n  if (pathname.startsWith(\"/admin\")) {\n    if (!token) {\n      return NextResponse.redirect(new URL(\"/\", request.url))\n    }\n\n    // This prevents redirect loop when token.isAdmin might be stale\n    if (token.isAdmin !== true) {\n      // Instead of immediate redirect, let the page check via API\n      // Only redirect if clearly not authenticated\n      const response = NextResponse.next()\n      response.headers.set(\"X-Admin-Check-Required\", \"true\")\n      return response\n    }\n\n    // Additional admin rate limiting\n    if (!security.checkRateLimit(`admin_${token.sub}`, 200, 60000)) {\n      return NextResponse.json({ error: \"Admin rate limit exceeded\" }, { status: 429 })\n    }\n  }\n\n  // API routes protection - only protect sensitive routes\n  if (pathname.startsWith(\"/api/download\") || pathname.startsWith(\"/api/upload\")) {\n    if (!token) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n  }\n\n  // Security headers\n  const response = NextResponse.next()\n  response.headers.set(\"X-Content-Type-Options\", \"nosniff\")\n  response.headers.set(\"X-Frame-Options\", \"DENY\")\n  response.headers.set(\"X-XSS-Protection\", \"1; mode=block\")\n  response.headers.set(\"Referrer-Policy\", \"strict-origin-when-cross-origin\")\n  response.headers.set(\n    \"Content-Security-Policy\",\n    \"default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https: blob:; font-src 'self' data: https:; media-src 'self' https: blob: data:; connect-src 'self' https:\",\n  )\n  response.headers.set(\"Permissions-Policy\", \"camera=(), microphone=(), geolocation=()\")\n\n  // Add CSRF token to response for client use\n  if (token?.sub) {\n    const csrfToken = security.generateCSRFToken(token.sub)\n    response.headers.set(\"X-CSRF-Token\", csrfToken)\n    response.cookies.set(\"csrf-token\", csrfToken, {\n      httpOnly: true,\n      secure: process.env.NODE_ENV === \"production\",\n      sameSite: \"strict\",\n      maxAge: 3600,\n    })\n  }\n\n  return response\n}\n\nexport const config = {\n  matcher: [\"/admin/:path*\", \"/api/:path*\", \"/upload/:path*\"],\n}\n"],"names":[],"mappings":";;;;;;AAAA;AAEA;AACA;AACA;;;;;AAEO,eAAe,MAAM,OAAoB;IAC9C,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ,OAAO;IACpC,MAAM,WAAW,QAAQ,OAAO,CAAC,GAAG,CAAC,sBAAsB,QAAQ,OAAO,CAAC,GAAG,CAAC,gBAAgB;IAE/F,MAAM,mBAAmB,MAAM,IAAA,+MAAa,EAAC;IAC7C,IAAI,iBAAiB,MAAM,KAAK,OAAO,iBAAiB,MAAM,KAAK,KAAK;QACtE,OAAO;IACT;IAEA,gBAAgB;IAChB,IAAI,CAAC,yMAAQ,CAAC,cAAc,CAAC,UAAU,KAAK,QAAQ;QAClD,OAAO,oNAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAsB,GAAG;YAAE,QAAQ;QAAI;IAC3E;IAEA,qBAAqB;IACrB,MAAM,QAAQ,MAAM,IAAA,8NAAQ,EAAC;QAC3B,KAAK;QACL,QAAQ,QAAQ,GAAG,CAAC,eAAe;IACrC;IAEA,0BAA0B;IAC1B,IAAI,SAAS,UAAU,CAAC,WAAW;QACjC,IAAI,CAAC,OAAO;YACV,OAAO,oNAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,KAAK,QAAQ,GAAG;QACvD;QAEA,gEAAgE;QAChE,IAAI,MAAM,OAAO,KAAK,MAAM;YAC1B,4DAA4D;YAC5D,6CAA6C;YAC7C,MAAM,WAAW,oNAAY,CAAC,IAAI;YAClC,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B;YAC/C,OAAO;QACT;QAEA,iCAAiC;QACjC,IAAI,CAAC,yMAAQ,CAAC,cAAc,CAAC,CAAC,MAAM,EAAE,MAAM,GAAG,EAAE,EAAE,KAAK,QAAQ;YAC9D,OAAO,oNAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4B,GAAG;gBAAE,QAAQ;YAAI;QACjF;IACF;IAEA,wDAAwD;IACxD,IAAI,SAAS,UAAU,CAAC,oBAAoB,SAAS,UAAU,CAAC,gBAAgB;QAC9E,IAAI,CAAC,OAAO;YACV,OAAO,oNAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;IACF;IAEA,mBAAmB;IACnB,MAAM,WAAW,oNAAY,CAAC,IAAI;IAClC,SAAS,OAAO,CAAC,GAAG,CAAC,0BAA0B;IAC/C,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACxC,SAAS,OAAO,CAAC,GAAG,CAAC,oBAAoB;IACzC,SAAS,OAAO,CAAC,GAAG,CAAC,mBAAmB;IACxC,SAAS,OAAO,CAAC,GAAG,CAClB,2BACA;IAEF,SAAS,OAAO,CAAC,GAAG,CAAC,sBAAsB;IAE3C,4CAA4C;IAC5C,IAAI,OAAO,KAAK;QACd,MAAM,YAAY,yMAAQ,CAAC,iBAAiB,CAAC,MAAM,GAAG;QACtD,SAAS,OAAO,CAAC,GAAG,CAAC,gBAAgB;QACrC,SAAS,OAAO,CAAC,GAAG,CAAC,cAAc,WAAW;YAC5C,UAAU;YACV,QAAQ,oDAAyB;YACjC,UAAU;YACV,QAAQ;QACV;IACF;IAEA,OAAO;AACT;AAEO,MAAM,SAAS;IACpB,SAAS;QAAC;QAAiB;QAAe;KAAiB;AAC7D"}}]
}